
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动态邮件回复模拟器</title>
    <style>
        :root {
            --primary-color: #007bff; --primary-hover-color: #0056b3; --background-color: #f8f9fa;
            --section-background: #ffffff; --text-color: #212529; --border-color: #dee2e6;
            --placeholder-color: #6c757d; --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        body { font-family: var(--font-family); background-color: var(--background-color); color: var(--text-color); margin: 0; padding: 2rem; line-height: 1.6; }
        #app { max-width: 1200px; margin: 0 auto; display: flex; flex-direction: column; gap: 2rem; }
        header { text-align: center; border-bottom: 2px solid var(--border-color); padding-bottom: 1.5rem; }
        h1 { margin: 0; font-size: 2.5rem; }
        header p { margin-top: 0.5rem; font-size: 1.1rem; color: var(--placeholder-color); }
        main { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        section { background-color: var(--section-background); padding: 1.5rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column; }
        h2 { margin-top: 0; margin-bottom: 1rem; font-size: 1.5rem; color: var(--primary-color); border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; }
        textarea { width: 100%; flex-grow: 1; padding: 0.75rem; font-size: 1rem; border: 1px solid var(--border-color); border-radius: 4px; resize: vertical; min-height: 250px; box-sizing: border-box; font-family: inherit; }
        #generate-reply-button { padding: 0.75rem 1.5rem; font-size: 1rem; font-weight: bold; color: #fff; background-color: var(--primary-color); border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease-in-out; margin-bottom: 1rem; }
        #generate-reply-button:disabled { background-color: #6c757d; cursor: not-allowed; }
        #ai-response-output { flex-grow: 1; background-color: #f1f3f5; padding: 1rem; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; min-height: 250px; }
        footer { text-align: center; margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--border-color); color: var(--placeholder-color); }
    </style>
</head>
<body>
    <div id="app">
        <header>
            <h1>动态邮件回复模拟器</h1>
            <p>练习中文邮件写作，并获得即时AI反馈</p>
        </header>
        <main>
            <section id="question-section">
                <h2>第一步：来信 (Question)</h2>
                <textarea id="question-input">小乐：

时间过得真快！我已经升上中二了。最近，我接到一个任务，就是以学长的身份参加“迎新周”活动，帮助中一的新生融入新环境。我感到有点儿紧张，因为我从没有组织过这种活动。我知道你以前也组织过“迎新周”活动，你们是怎么组织这个活动的呢？在组织活动的过程中，我有什么需要注意的呢？

希望早日收到你的回邮。

祝好！

小明</textarea>
            </section>
            <section id="answer-section">
                <h2>第二步：您的回复 (Answer)</h2>
                <textarea id="answer-input" placeholder="在此输入您对第一封邮件的回复..."></textarea>
            </section>
            <section id="ai-response-section">
                <h2>第三步：AI生成的回信 (AI Response)</h2>
                <button id="generate-reply-button">生成AI回复</button>
                <div id="ai-response-output">点击上方按钮，AI将在此生成回复...</div>
            </section>
        </main>
        <footer>
            <p>技术支持：Hugging Face Transformers.js | 模型：Xenova/gpt2-chinese-cluecorpussmall</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@huggingface/transformers@2.17.0"></script>
    
    <script>
        // This function will run ONLY after the whole page, including the script above, is fully loaded.
        window.onload = function() {
            const pipeline = transformers.pipeline;

            const questionInput = document.getElementById('question-input');
            const answerInput = document.getElementById('answer-input');
            const generateButton = document.getElementById('generate-reply-button');
            const aiResponseOutput = document.getElementById('ai-response-output');

            let generator = null;

            generateButton.addEventListener('click', async () => {
                const questionText = questionInput.value.trim();
                const answerText = answerInput.value.trim();

                if (!answerText) {
                    alert('请在“您的回复”区域输入内容。');
                    return;
                }
                
                generateButton.disabled = true;
                aiResponseOutput.textContent = '正在准备AI...';

                try {
                    if (generator === null) {
                        aiResponseOutput.textContent = '首次加载中文AI模型，请稍候...（此过程可能需要一些时间）';
                        generator = await pipeline('text-generation', 'Xenova/gpt2-chinese-cluecorpussmall');
                    }

                    aiResponseOutput.textContent = '模型准备就绪，正在生成回复...';

                    const promptLines = [
                        '这是一个邮件对话。第一封邮件是提问，第二封是回复。请你扮演第一封邮件的发件人，根据对话内容，写第三封邮件，确保回复中的人名和语气与前两封邮件保持一致。',
                        '',
                        '第一封邮件：' + questionText,
                        '',
                        '第二封邮件：' + answerText,
                        '',
                        '第三封邮件回复：'
                    ];
                    const prompt = promptLines.join('\n');

                    const output = await generator(prompt, {
                        max_new_tokens: 250,
                        temperature: 0.7,
                        top_k: 50,
                        skip_special_tokens: true
                    });

                    const fullText = output[0].generated_text;
                    const generatedReply = fullText.split('第三封邮件回复：')[1] || fullText;
                    
                    aiResponseOutput.textContent = generatedReply.trim();

                } catch (error) {
                    console.error('Error generating reply:', error);
                    aiResponseOutput.textContent = `生成回复时发生错误：\n${error.message}`;
                } finally {
                    generateButton.disabled = false;
                }
            });
        };
    </script>
</body>
</html>